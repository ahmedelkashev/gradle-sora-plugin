# gradle-devops-helper

Min supported gradle 4.8

## Tasks

| **Task name**    | **Env/Prop**       | **Tasks executed**                                     | **Description**                                         |
|------------------|--------------------|--------------------------------------------------------|---------------------------------------------------------|
| build            | -                  | compile + build                                        | Builds, does NOT execute check or test.                 |
| check            | -                  | build + test + check                                   | Builds, then executes static code analyzers             |
| test             | -                  | build + test                                           | Builds, then executes all registered tests              |
| coverage         | -                  | build + test + coverage                                | Builds, executes tests and then collects code coverage. |
| printOsInfo      | -                  | printOsInfo                                            | Prints information about OS and project                 |
| printVersion     | -                  | printVersion                                           | Prints project version based on git                     |
| printConfig      | same as for docker | printConfig                                            | Prints plugin configuration                             |
| dockerVersion    | -                  | dockerVersion                                          | Prints current docker version                           |
| dockerClean      | -                  | dockerClean                                            | Cleans docker build context (build/docker)              |
| dockerfileCreate | -                  | dockerClean + dockerfileCreate                         | Generates Dockerfile in build context                   |
| dockerCopyJar    | -                  | build                                                  | Builds and copies JAR to build context                  |
| dockerBuild      | -                  | dockerClean + build + dockerCopyJar + dockerfileCreate | Builds image with autogenerated tag                     |
| dockerPush       | -                  | dockerBuild + dockerPush                               | Pushes image to docker registry                         |

## Configuration

All fields are optional.

build.gradle:
```
soramitsu {
  projectGroup = 'sora' # define namespace for your project. default: null
  docker {
    jar = new File(...) # path to output JAR which is going to be dockerized
    tag = "custom-tag"  # docker tag 
    registry {
      url = 'https://nexus.iroha.tech:19001' # define url of docker registry
      username = 'bogdan'
      password = 'password'
      email = 'bogdan@soramitsu.co.jp' 
    }
  }
}
```

Docker registry data can be defined from env vars:
```
DOCKER_REGISTRY_URL="https://nexus.iroha.tech:19001"
DOCKER_REGISTRY_USERNAME="bogdan"
DOCKER_REGISTRY_PASSWORD="password"
DOCKER_REGISTRY_EMAIL="bogdan@soramitsu.co.jp"
```

Env vars ALWAYS overwrite any value from build.gradle.

## Features

- [x] build does not invoke tests
- [ ] separate `check` task for static code analysis; formatting analysis
- [x] `coverage` task, which invokes all tests and   
- [x] `dockerBuild` task to build docker image
- [x] automatic tag generation. Tag consists of `${url}/${projectGroup}/${project.name}:${project.version}`
  - url - url of docker registry without http(s)://
  - projectGroup - e.g. sora, bakong, etc.  
  - project.name - defined in settings.gradle
  - project.version - git version
- [x] configuration of docker registry from env vars


